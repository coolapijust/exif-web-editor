# 技术选型文档

## 一、技术栈概览

本项目采用现代化的纯前端技术栈，核心目标是实现高性能的 EXIF 信息读取和编辑功能，同时保证代码的模块化和可维护性。整体技术选型遵循以下原则：优先选择成熟稳定的方案、确保良好的开发体验、追求极致的运行时性能，以及支持细粒度的模块化架构。

经过综合评估，本项目最终确定的技术栈组合为：Vue 3 作为前端框架、Vite 作为构建工具、Tailwind CSS 作为样式方案、TypeScript 作为开发语言，以及 @uswriting/exiftool 作为 EXIF 处理引擎。这套技术组合在性能、开发效率和功能覆盖方面达到了最佳平衡点，能够满足项目「尽可能支持更多图片格式」的核心需求。

## 二、核心框架选择

### 2.1 候选框架对比分析

在前端框架的选择上，市场上主要有 Vue 3、React 和 Svelte 三个主流选项。Svelte 虽然在性能方面表现优异，但其社区生态相对较小，第三方库支持有限，对于需要处理复杂 EXIF 数据和多种图片格式的项目而言，选择 Svelte 可能会面临库兼容性不足的问题。React 虽然生态最为丰富，但其在状态管理方面需要额外引入 Redux 或 MobX 等库，增加了项目复杂度。相比之下，Vue 3 在保持轻量的同时，提供了完整的响应式系统和状态管理方案，且其 Composition API 的设计非常适合实现细粒度的模块化代码组织。

Vue 3 的另一大优势在于其单文件组件（.vue）的组织方式，这种模式天然支持将模板、脚本和样式分离到同一文件中，使得代码逻辑更加清晰。结合 TypeScript 的类型系统，可以实现完整的类型检查和智能提示，显著降低大型项目的维护成本。此外，Vue 3 的官方工具链（Vite、Pinia、Vue Router）与框架本身深度集成，提供了开箱即用的开发体验，这对于个人项目而言尤为重要。

### 2.2 最终选择：Vue 3

综合考虑项目需求和个人开发场景，本项目选择 Vue 3 作为核心框架。Vue 3 的 Composition API 特性特别适合本项目的模块化设计要求，可以将 EXIF 读取、写入、格式化等逻辑封装为独立的组合式函数，在不同组件中复用。此外，Vue 3 对 TypeScript 的原生支持使得类型定义更加自然，代码可维护性更高。相比 React 需要额外配置 JSX 编译和状态管理库，Vue 3 的集成方案更加简洁，减少了项目初始化的配置工作。

## 三、构建工具选择

### 3.1 构建工具评估维度

构建工具的选择直接影响开发体验和应用性能。评估构建工具时，主要考量以下几个维度：开发服务器的启动速度、热模块替换的响应时间、生产环境的打包体积和性能，以及工具本身的配置复杂度。现代前端项目对构建工具的要求已经不仅限于「能够打包」，更追求「快速打包」和「优化打包」，尤其是在开发阶段，启动速度和热更新效率直接影响开发者的编码体验。

Vite 作为新一代构建工具的代表，采用原生 ES 模块的开发服务器设计，实现了极快的冷启动速度。与传统基于 Webpack 的方案相比，Vite 在开发模式下无需打包即可直接运行代码，显著缩短了等待时间。在生产环境中，Vite 使用 Rollup 进行打包，输出结果经过高度优化， bundle 体积更小。此外，Vite 对 TypeScript、CSS 预处理器、WebAssembly 等技术提供了原生支持，无需复杂配置即可集成。

### 3.2 最终选择：Vite

本项目选择 Vite 作为构建工具，这一决策基于以下考量：首先是开发效率，Vite 的即时启动和极速热更新能够显著提升开发体验；其次是生态支持，Vite 与 Vue 3 由同一团队开发，两者深度集成且持续同步更新；最后是生产性能，Vite 基于 Rollup 的生产构建经过多年优化，能够输出高质量的打包结果。对于本项目而言，Vite 的 WebAssembly 加载支持也是重要考量点，这为 @uswriting/exiftool 的集成提供了便利。

## 四、EXIF 处理库选择

### 4.1 候选方案分析

EXIF 处理库的选择是本项目的核心技术决策，直接决定了功能实现的深度和广度。经过详细调研，市场上主要有以下几类方案：第一类是纯 JavaScript 实现的轻量库，如 exifr、exif-js 和 piexifjs，这类库通常体积小、加载快，但功能覆盖有限；第二类是基于 WebAssembly 的方案，如 @uswriting/exiftool，这类库能够调用原生的 ExifTool 能力，支持几乎所有图片格式；第三类是 Node.js 方案，如 exiftool-vendored，但由于需要后端支持，不符合本项目纯前端的要求。

exifr 是目前纯 JavaScript 方案中功能最强大的读取库，支持 JPEG、PNG、HEIC、RAW 等多种格式的 EXIF 读取，体积约 15KB，但仅支持读取不支持写入。piexifjs 则专注于 JPEG 格式的读写，但格式支持非常有限。这两个库的组合可以实现 JPEG 的完整读写功能，但对于 PNG、WebP、HEIC 等格式则无能为力。

### 4.2 推荐方案：@uswriting/exiftool

经过综合评估，本项目选择 @uswriting/exiftool 作为核心 EXIF 处理引擎。该库基于 WebAssembly 技术，在浏览器中运行 ExifTool 的完整功能，具有以下核心优势：格式支持全面，理论上支持 ExifTool 所支持的所有图片格式，包括 JPEG、PNG、WebP、HEIC、TIFF、RAW 等；读写能力完整，不仅支持读取，更支持写入 EXIF 数据；性能优异，WebAssembly 的执行效率接近原生代码；纯前端运行，无需服务器支持，数据处理全程在本地完成。

@uswriting/exiftool 的工作原理是将 ExifTool（Perl 实现）编译为 WebAssembly 格式，使其能够在浏览器环境中直接执行。这种方案的优势在于继承了 ExifTool 十几年来积累的格式解析能力，避免了从零实现各种格式解析器的巨大工作量。同时，由于数据处理全程在浏览器本地进行，不涉及网络传输，用户无需担心隐私泄露问题，这对于处理包含位置信息等敏感数据的 EXIF 场景尤为重要。

### 4.3 技术限制说明

尽管 @uswriting/exiftool 功能强大，但仍需注意其技术限制：首先是 WASM 文件体积较大，完整的 ExifTool WASM 二进制文件通常在 3-5MB 左右，会增加首次加载的时间；其次是初始化开销，WASM 模块需要一定的初始化时间才能执行；第三是浏览器兼容性，需要支持 WebAssembly 的现代浏览器才能运行。针对这些限制，本项目采用懒加载策略，WASM 模块在用户首次需要时加载，避免阻塞首屏渲染。

## 五、UI 方案选择

### 5.1 候选方案对比

UI 方案的选择需要在开发效率和定制灵活性之间取得平衡。主要候选方案包括：原生 CSS、手写样式方案，这类方案能够实现完全自定义的视觉效果，但开发效率较低；Tailwind CSS 原子化方案，通过组合 utility 类实现样式，开发速度快且不会产生样式冲突；Headless UI 无样式组件库，提供完整的功能逻辑但不含默认样式，需要自行设计视觉呈现；完整 UI 组件库，如 Element Plus、Ant Design，提供开箱即用的组件但定制灵活性受限。

Tailwind CSS 的核心设计理念是「原子化 CSS」，即每个类名对应一个具体的 CSS 属性，通过组合类名实现任意样式效果。这种方式的优势在于：无需为类名绞尽脑汁，直接使用语义化的类名如 flex、pt-4、text-center 等；不会产生样式冲突，因为每个类名的作用域是明确的；生产构建时会自动移除未使用的 CSS，实现极小的打包体积。结合 TypeScript 和 Vue 3，可以实现类型安全的样式编写。

### 5.2 最终选择：Tailwind CSS

本项目选择 Tailwind CSS 作为样式方案。选择 Tailwind 的理由包括：开发效率高，无需频繁切换 HTML 和 CSS 文件，样式就在元素上；响应式支持完善，内置断点系统实现响应式布局；深色模式支持，内置 dark: 前缀实现深色主题；定制能力强，通过配置文件自定义设计系统。虽然 Tailwind 初期学习曲线较陡，但一旦熟悉其命名规范，开发速度会显著提升。

考虑到项目强调模块化和代码整洁性，Tailwind 的另一个优势是与 Vue 组件的配合。组件内部的样式通过类名定义，样式逻辑与组件功能在同一位置，便于理解和维护。对于需要复用的样式片段，可以提取为 Vue 的全局样式类或使用 @apply 指令，在保持原子化优势的同时实现代码复用。

## 六、状态管理方案

### 6.1 Pinia 状态管理

Vue 3 生态中的官方状态管理库是 Pinia，它完全兼容 Vue 3 的 Composition API，提供类型安全的状态管理能力。相比 Vuex，Pinia 的 API 更加简洁，无需编写冗长的 mutations 和 actions，状态定义和使用方式更加直观。Pinia 的另一个优势是与 TypeScript 的深度集成，能够自动推断状态类型，编写类型安全的修改代码。

本项目采用 Pinia 进行状态管理，主要管理三类状态：文件状态（FileStore）管理用户选择的文件和当前选中项；EXIF 数据状态（ExifStore）管理读取到的元数据信息；UI 状态（UIStore）管理主题、弹窗、通知等界面状态。这种状态分离设计使得各部分逻辑清晰，状态流转可追溯，便于调试和问题定位。

### 6.2 组合式函数补充

除了 Pinia 管理的全局状态外，本项目还设计了组合式函数（Composables）来处理组件内的状态和逻辑复用。组合式函数是 Vue 3 的核心特性之一，通过函数封装可复用的状态逻辑，在不同组件中按需调用。本项目定义了 useExif（EXIF 操作封装）、useFile（文件操作封装）和 useUi（UI 交互封装）三个核心组合式函数，将组件中通用的状态逻辑提取出来，实现「关注点分离」的设计目标。

## 七、最终技术方案

### 7.1 技术栈清单

经过上述分析和决策，本项目的最终技术栈组合如下：框架层面采用 Vue 3（版本 3.4+），使用 Composition API 和 <script setup> 语法糖进行组件开发；构建工具采用 Vite（版本 5+），利用其极速的开发体验和优化的生产构建能力；样式方案采用 Tailwind CSS（版本 3.4+），配合 @headlessui/vue 实现可访问性良好的交互组件；开发语言采用 TypeScript（版本 5+），提供完整的类型检查和智能提示支持。

EXIF 处理引擎采用 @uswriting/exiftool（版本 1.x），通过 WebAssembly 技术实现全格式支持。状态管理采用 Pinia（版本 2+），管理应用全局状态。日期处理采用 date-fns（版本 3+），提供轻量级的日期格式化功能。图标库采用 @heroicons/vue（版本 2+），提供与 Tailwind 设计风格一致的 SVG 图标。

### 7.2 模块化架构要点

本项目强调模块化设计，遵循以下核心原则：职责单一原则，每个模块只负责一类具体功能，如 executor 模块只负责 WASM 执行，parser 模块只负责数据解析；依赖倒置原则，高层模块不依赖低层模块的具体实现，而是依赖抽象接口，便于单元测试和模块替换；最小暴露原则，模块只导出必要的 API，内部实现细节对外部不可见，降低耦合度。

具体到代码层面，每个 TypeScript 文件的代码行数控制在 150 行以内。超过此限制的模块需要进一步拆分，例如 executor 模块拆分为 loader.ts（加载 WASM）、initializer.ts（初始化）、caller.ts（调用封装）三个文件。这种细粒度的模块划分虽然会增加文件数量，但显著提升了代码的可读性、可测试性和可维护性。

### 7.3 技术选型决策总结

| 领域 | 选择 | 核心优势 |
|------|------|----------|
| 前端框架 | Vue 3 | 简单上手、Composition API、类型安全 |
| 构建工具 | Vite | 极速启动、热更新、良好生态 |
| 样式方案 | Tailwind CSS | 开发效率高、原子化、无样式冲突 |
| EXIF 引擎 | @uswriting/exiftool | 全格式支持、读写能力、WebAssembly |
| 状态管理 | Pinia | 类型安全、API 简洁、官方支持 |
| 开发语言 | TypeScript | 类型检查、智能提示、可维护性 |

## 八、依赖清单

### 8.1 生产环境依赖

```json
{
  "dependencies": {
    "vue": "^3.4.0",
    "pinia": "^2.1.0",
    "@uswriting/exiftool": "^1.0.0",
    "date-fns": "^3.3.0",
    "@heroicons/vue": "^2.1.0"
  },
  "devDependencies": {
    "vite": "^5.1.0",
    "typescript": "^5.3.0",
    "vue-tsc": "^2.0.0",
    "tailwindcss": "^3.4.0",
    "autoprefixer": "^10.4.0",
    "postcss": "^8.4.0",
    "@vitejs/plugin-vue": "^5.0.0"
  }
}
```

### 8.2 依赖版本策略

所有依赖采用语义化版本（Semantic Versioning）管理，主版本号固定以确保 API 稳定性。生产环境依赖锁定具体版本号，避免自动升级引入不兼容变更。开发环境依赖同样锁定版本，确保团队成员使用一致的工具链。版本升级遵循「小版本优先」原则，优先升级补丁版本修复问题，评估小版本的新功能后再决定是否升级，主版本升级需要经过充分测试。

## 九、开发环境配置

### 9.1 必需工具

开发本项目需要安装以下工具：Node.js（版本 20 LTS 或更高），建议使用 nvm 或 fnm 进行版本管理；包管理器推荐 pnpm（版本 8+），其磁盘利用率和安装速度优于 npm；代码编辑器推荐 VS Code，配合 Volar 插件获得最佳的 Vue + TypeScript 开发体验。

### 9.2 开发环境验证

项目初始化后，建议运行以下命令验证开发环境：pnpm install 安装依赖；pnpm run dev 启动开发服务器，验证 Vite 是否正常工作；pnpm run build 执行生产构建，验证打包流程是否正常；pnpm run typecheck 运行类型检查，验证 TypeScript 配置是否正确。如果所有命令执行成功，说明开发环境配置正确，可以开始正式开发工作。

### 9.3 开发规范配置

项目内置了以下开发规范配置：ESLint 用于 JavaScript/TypeScript 代码检查；Prettier 用于代码格式化；stylelint 用于 CSS 代码检查。这些工具在 pnpm run lint 命令中统一执行，确保代码风格一致性。提交代码前建议运行 pnpm run lint:fix 自动修复可修复的问题，减少代码审查的沟通成本。
